<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CNPJ</title>
    <!--bootstrap-->
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js" integrity= 
    "sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/" crossorigin="anonymous"></script>
    <!-- JQUERY-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body><br><br><br>
    <form class="row g-3 container mx-auto w-100 mt-100" action="<?php echo URL_BASE; ?>admin/cadastrar" method="POST">
        <div class="col-md-6 w-25">
          <label for="inputCnpj" class="form-label">Cnpj</label>
          <input type="text" class="form-control" placeholder="Apenas números" name="inputCnpj" id="inputCnpj" required>
        </div>
        <div class="col-md-1 mt-4">
            <button id="pesquisar" class="btn btn-primary mt-4">Buscar</button>
        </div>
        <div class="col-md-4 w-47">
          <label for="inputRazao" class="form-label">Razão social</label>
          <input type="text" class="form-control" name="inputRazao" id="inputRazao" required>
        </div>
        <div class="col-md-4">
          <label for="inputFantasia" class="form-label">Fantasia</label>
          <input type="text" class="form-control" name="inputFantasia" id="inputFantasia" required>
        </div>
        <div class="col-6">
          <label for="inputLogradouro" class="form-label">logradouro</label>
          <input type="text" class="form-control" name="inputLogradouro" id="inputLogradouro" required>
        </div>
        <div class="col-2">
          <label for="inputNumero" class="form-label">Número</label>
          <input type="number" class="form-control" name="inputNumero" id="inputNumero" required>
        </div>
        <div class="col-md-6 w-25">
          <label for="inputBairro" class="form-label">Bairro</label>
          <input type="text" class="form-control" name="inputBairro" id="inputBairro" required>
        </div>
        <div class="col-md-6">
          <label for="inputCidade" class="form-label">Cidade</label>
          <input type="text" class="form-control" name="inputCidade" id="inputCidade" required>
        </div>
        <div class="col-md-4 w-25">
          <label for="inputUF" class="form-label">Estado</label>
          <input type="text" class="form-control" name="inputUF" id="inputUF" required>
        </div>
        <div class="col-md-3">
          <label for="inputFone" class="form-label">Fone</label>
          <input type="text" class="form-control" placeholder="Apenas números" name="inputFone" id="inputFone" required>
        </div>
        <div class="col-md-3">
          <label for="inputCelular" class="form-label">Celular</label>
          <input type="text" class="form-control" name="inputCelular" id="inputCelular" required>
        </div>
        <div class="col-md-4">
          <label for="inputEmail" class="form-label">Email</label>
          <input type="text" class="form-control" name="inputEmail" id="inputEmail" required>
        </div>
      
    </form>
     </div> 

     <script type="text/javascript">
        $(document).ready(function(){
    
      // Adicionamos o evento onclick ao botão com o ID "pesquisar"
      $('#pesquisar').on('click', function(e) {
        
        e.preventDefault();
        
        var cnpj = $('#inputCnpj').val().replace(/[^0-9]/g, '');
        
        // Fazemos uma verificação simples do cnpj confirmando se ele tem 14 caracteres
        if(cnpj.length == 14) {
        
          // Aqui rodamos o ajax para a url da API concatenando o número do CNPJ na url
          $.ajax({
            url:'https://www.receitaws.com.br/v1/cnpj/' + cnpj,
            method:'GET',
            dataType: 'jsonp', // Em requisições AJAX para outro domínio é necessário usar o formato "jsonp" que é o único aceito pelos navegadores por questão de segurança
            complete: function(xhr){
            
              // Aqui recuperamos o json retornado
              response = xhr.responseJSON;
              
              // Na documentação desta API tem esse campo status que retorna "OK" caso a consulta tenha sido efetuada com sucesso
              if(response.status == 'OK') {
              
                // Agora preenchemos os campos com os valores retornados
                $('#inputRazao').val(response.nome);
                $('#inputFantasia').val(response.fantasia);
                $('#inputLogradouro').val(response.logradouro);
                $('#inputEmail').val(response.email);
                $('#inputFone').val(response.telefone);
                $('#inputCidade').val(response.municipio);
                $('#inputBairro').val(response.bairro);
                $('#inputNumero').val(response.numero);
                $('#inputUF').val(response.uf);
                    
              // Aqui exibimos uma mensagem caso tenha ocorrido algum erro
              } else {
                alert(response.message); // Neste caso estamos imprimindo a mensagem que a própria API retorna
              }
            }
          });
        
        // Tratativa para caso o CNPJ não tenha 14 caracteres
        } else {
          alert('CNPJ inválido');
        }
      });
    });
    </script>
</body>
</html>